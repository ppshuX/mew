{% extends "base.html" %}
{% load static %}
{% block title %}个人空间 - {{ user_profile.user.username }}{% endblock %}

{% block extra_head %}
<!-- 强制加载静态文件，防止缓存 -->
<link rel="stylesheet" href="{% static 'userzone/css/userzone.css' %}?v=4">
<script src="{% static 'userzone/js/userzone.js' %}?v=4"></script>
{% endblock %}

{% block content %}
<div class="uz-grid-root">
    <!-- 左栏 -->
    <div class="uz-left">
        <!-- 用户信息卡片 -->
        <div class="card uz-card uz-user-info">
            <div class="card-body d-flex align-items-center gap-4">
                <img src="{{ user_profile.avatar.url }}" class="rounded-circle uz-avatar"
                    alt="{{ user_profile.nickname }}">
                <div class="flex-grow-1">
                    <div class="uz-nickname">{{ user_profile.nickname }}</div>
                    <div class="uz-school">{{ user_profile.school }}</div>
                    <div class="uz-signature">{{ user_profile.bio|default:"这个人很神秘，什么都没写。" }}</div>
                </div>
            </div>
        </div>

        <!-- 统计信息卡片 -->
        <div class="card uz-card">
            <div class="card-body">
                <div class="uz-stats">
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">关注</span>
                        <span class="uz-stat-number">{{ user_profile.following_count|default:0 }}</span>
                    </div>
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">粉丝</span>
                        <span class="uz-stat-number">{{ user_profile.follower_count|default:0 }}</span>
                    </div>
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">阅读</span>
                        <span class="uz-stat-number">{{ user_profile.view_count|default:0 }}</span>
                    </div>
                </div>

                <!-- 在线状态 -->
                <div class="uz-online-status">
                    <span class="uz-dot {% if user_profile.is_online %}online{% endif %}"></span>
                    <span class="uz-location">{{ user_profile.ip_location }}</span>
                </div>

                <!-- 最近访客 -->
                <div class="uz-visitors-section">
                    <div class="uz-visitors-title">最近访客</div>
                    <div class="uz-visitors-grid">
                        {% for v in recent_visitors %}
                        <img src="{{ v.avatar.url }}" title="{{ v.nickname }}" class="uz-visitor-avatar"
                            alt="{{ v.nickname }}">
                        {% empty %}
                        <span class="uz-no-visitor">暂无访客</span>
                        {% endfor %}
                    </div>
                </div>

                <!-- 操作按钮 -->
                {% if is_owner %}
                <a href="{% url 'user_profile_detail' user_profile.user.username %}"
                    class="uz-btn uz-btn-center">进入个人详情页</a>
                {% else %}
                <a href="/profile/{{ user_profile.user.username }}/" class="uz-btn uz-btn-center">进入个人详情页</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 右栏 -->
    <div class="uz-right">
        <!-- 朋友圈动态 -->
        <div class="card uz-card">
            <div class="card-body">
                <h5 class="uz-section-title">
                    <span class="uz-section-icon">🔒</span>
                    我的朋友圈
                </h5>
                <div>
                    {% for post in moments_posts %}
                    <div class="uz-post-card">
                        <div class="uz-post-header">
                            <span class="uz-post-author">{{ post.author.nickname }}</span>
                            <span class="uz-post-time">{{ post.created_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        <div class="uz-post-content">{{ post.content }}</div>
                        {% if post.images.all %}
                        <div class="uz-post-images">
                            <div class="uz-image-grid grid-{{ post.images.count|add:" 0" }}">
                                {% for img in post.images.all %}
                                <img src="{{ img.url }}" class="uz-post-img" alt="动态图片">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="uz-post-footer">
                            <a href="{% url 'moments:post_detail' post.id %}" class="uz-post-action">
                                <span class="uz-post-action-icon">👁️</span>
                                查看详情
                            </a>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">👍</span>
                                {{ post.likes.count|default:0 }}
                            </span>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">💬</span>
                                {{ post.comments.count|default:0 }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="uz-empty-state">
                        <div class="uz-empty-icon">📝</div>
                        <div class="uz-empty-text">你还没有发朋友圈哦~</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- 广场动态 -->
        <div class="card uz-card">
            <div class="card-body">
                <h5 class="uz-section-title">
                    <span class="uz-section-icon">🌐</span>
                    Ta 的广场动态
                </h5>
                <div>
                    {% for post in plaza_posts %}
                    <div class="uz-post-card">
                        <div class="uz-post-header">
                            <span class="uz-post-author">{{ post.author.nickname }}</span>
                            <span class="uz-post-time">{{ post.created_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        <div class="uz-post-content">{{ post.content }}</div>
                        {% if post.images.all %}
                        <div class="uz-post-images">
                            <div class="uz-image-grid grid-{{ post.images.count|add:" 0" }}">
                                {% for img in post.images.all %}
                                <img src="{{ img.url }}" class="uz-post-img" alt="动态图片">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="uz-post-footer">
                            <a href="{% url 'plaza:detail' post.id %}" class="uz-post-action">
                                <span class="uz-post-action-icon">👁️</span>
                                查看详情
                            </a>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">👍</span>
                                {{ post.likes.count|default:0 }}
                            </span>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">💬</span>
                                {{ post.comments.count|default:0 }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="uz-empty-state">
                        <div class="uz-empty-icon">🌍</div>
                        <div class="uz-empty-text">暂无广场动态</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}