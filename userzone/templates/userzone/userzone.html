{% extends "base.html" %}
{% load static %}
{% block title %}ä¸ªäººç©ºé—´ - {{ user_profile.user.username }}{% endblock %}

{% block extra_head %}
<!-- å¼ºåˆ¶åŠ è½½é™æ€æ–‡ä»¶ï¼Œé˜²æ­¢ç¼“å­˜ -->
<link rel="stylesheet" href="{% static 'userzone/css/userzone.css' %}?v=4">
<script src="{% static 'userzone/js/userzone.js' %}?v=4"></script>
{% endblock %}

{% block content %}
<div class="uz-grid-root">
    <!-- å·¦æ  -->
    <div class="uz-left">
        <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
        <div class="card uz-card uz-user-info">
            <div class="card-body d-flex align-items-center gap-4">
                <img src="{{ user_profile.avatar.url }}" class="rounded-circle uz-avatar"
                    alt="{{ user_profile.nickname }}">
                <div class="flex-grow-1">
                    <div class="uz-nickname">{{ user_profile.nickname }}</div>
                    <div class="uz-school">{{ user_profile.school }}</div>
                    <div class="uz-signature">{{ user_profile.bio|default:"è¿™ä¸ªäººå¾ˆç¥ç§˜ï¼Œä»€ä¹ˆéƒ½æ²¡å†™ã€‚" }}</div>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
        <div class="card uz-card">
            <div class="card-body">
                <div class="uz-stats">
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">å…³æ³¨</span>
                        <span class="uz-stat-number">{{ user_profile.following_count|default:0 }}</span>
                    </div>
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">ç²‰ä¸</span>
                        <span class="uz-stat-number">{{ user_profile.follower_count|default:0 }}</span>
                    </div>
                    <div class="uz-stat-item">
                        <span class="uz-stat-label">é˜…è¯»</span>
                        <span class="uz-stat-number">{{ user_profile.view_count|default:0 }}</span>
                    </div>
                </div>

                <!-- åœ¨çº¿çŠ¶æ€ -->
                <div class="uz-online-status">
                    <span class="uz-dot {% if user_profile.is_online %}online{% endif %}"></span>
                    <span class="uz-location">{{ user_profile.ip_location }}</span>
                </div>

                <!-- æœ€è¿‘è®¿å®¢ -->
                <div class="uz-visitors-section">
                    <div class="uz-visitors-title">æœ€è¿‘è®¿å®¢</div>
                    <div class="uz-visitors-grid">
                        {% for v in recent_visitors %}
                        <img src="{{ v.avatar.url }}" title="{{ v.nickname }}" class="uz-visitor-avatar"
                            alt="{{ v.nickname }}">
                        {% empty %}
                        <span class="uz-no-visitor">æš‚æ— è®¿å®¢</span>
                        {% endfor %}
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                {% if is_owner %}
                <a href="{% url 'user_profile_detail' user_profile.user.username %}"
                    class="uz-btn uz-btn-center">è¿›å…¥ä¸ªäººè¯¦æƒ…é¡µ</a>
                {% else %}
                <a href="/profile/{{ user_profile.user.username }}/" class="uz-btn uz-btn-center">è¿›å…¥ä¸ªäººè¯¦æƒ…é¡µ</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- å³æ  -->
    <div class="uz-right">
        <!-- æœ‹å‹åœˆåŠ¨æ€ -->
        <div class="card uz-card">
            <div class="card-body">
                <h5 class="uz-section-title">
                    <span class="uz-section-icon">ğŸ”’</span>
                    æˆ‘çš„æœ‹å‹åœˆ
                </h5>
                <div>
                    {% for post in moments_posts %}
                    <div class="uz-post-card">
                        <div class="uz-post-header">
                            <span class="uz-post-author">{{ post.author.nickname }}</span>
                            <span class="uz-post-time">{{ post.created_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        <div class="uz-post-content">{{ post.content }}</div>
                        {% if post.images.all %}
                        <div class="uz-post-images">
                            <div class="uz-image-grid grid-{{ post.images.count|add:" 0" }}">
                                {% for img in post.images.all %}
                                <img src="{{ img.url }}" class="uz-post-img" alt="åŠ¨æ€å›¾ç‰‡">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="uz-post-footer">
                            <a href="{% url 'moments:post_detail' post.id %}" class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ‘ï¸</span>
                                æŸ¥çœ‹è¯¦æƒ…
                            </a>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ‘</span>
                                {{ post.likes.count|default:0 }}
                            </span>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ’¬</span>
                                {{ post.comments.count|default:0 }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="uz-empty-state">
                        <div class="uz-empty-icon">ğŸ“</div>
                        <div class="uz-empty-text">ä½ è¿˜æ²¡æœ‰å‘æœ‹å‹åœˆå“¦~</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- å¹¿åœºåŠ¨æ€ -->
        <div class="card uz-card">
            <div class="card-body">
                <h5 class="uz-section-title">
                    <span class="uz-section-icon">ğŸŒ</span>
                    Ta çš„å¹¿åœºåŠ¨æ€
                </h5>
                <div>
                    {% for post in plaza_posts %}
                    <div class="uz-post-card">
                        <div class="uz-post-header">
                            <span class="uz-post-author">{{ post.author.nickname }}</span>
                            <span class="uz-post-time">{{ post.created_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        <div class="uz-post-content">{{ post.content }}</div>
                        {% if post.images.all %}
                        <div class="uz-post-images">
                            <div class="uz-image-grid grid-{{ post.images.count|add:" 0" }}">
                                {% for img in post.images.all %}
                                <img src="{{ img.url }}" class="uz-post-img" alt="åŠ¨æ€å›¾ç‰‡">
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="uz-post-footer">
                            <a href="{% url 'plaza:detail' post.id %}" class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ‘ï¸</span>
                                æŸ¥çœ‹è¯¦æƒ…
                            </a>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ‘</span>
                                {{ post.likes.count|default:0 }}
                            </span>
                            <span class="uz-post-action">
                                <span class="uz-post-action-icon">ğŸ’¬</span>
                                {{ post.comments.count|default:0 }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="uz-empty-state">
                        <div class="uz-empty-icon">ğŸŒ</div>
                        <div class="uz-empty-text">æš‚æ— å¹¿åœºåŠ¨æ€</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}